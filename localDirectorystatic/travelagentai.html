<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI 旅遊助理 Widget</title>

<style>
body { 
  margin:0; 
  font-family: 'Segoe UI', Roboto, sans-serif; 
  background:#101010; 
  color:#fff; 
}

.chat-widget {
  position: fixed; 
  right: 20px; 
  bottom: 20px;
  z-index: 9999; 
  display:flex; 
  flex-direction:column; 
  align-items:flex-end; 
  gap:10px;
}

.chat-btn {
  background: linear-gradient(135deg, #ffcc70, #ff7eb3);
  border: none; 
  border-radius: 50px;
  padding: 14px 20px; 
  font-weight:700; 
  font-size:15px;
  cursor:pointer;
  color:#111;
  box-shadow: 0 6px 20px rgba(0,0,0,0.4);
  transition: transform .2s ease;
}
.chat-btn:hover { transform: scale(1.05); }

.chat-panel {
  position: fixed; 
  right: 20px; 
  bottom: 80px; 
  width: 380px; 
  max-width: 92vw;
  background: rgba(255,255,255,0.07);
  backdrop-filter: blur(12px) saturate(180%);
  -webkit-backdrop-filter: blur(12px) saturate(180%);
  border-radius:18px; 
  overflow:hidden;
  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
  border:1px solid rgba(255,255,255,0.15);
  display:flex; 
  flex-direction:column;
  opacity:0; 
  transform:translateY(20px);
  pointer-events:none; 
  visibility:hidden;
  transition: opacity .3s ease, transform .3s ease, visibility 0s linear .3s;
}
.chat-panel.open {
  opacity:1;
  transform:translateY(0);
  pointer-events:auto;
  visibility:visible;
  transition: opacity .3s ease, transform .3s ease;
}

.chat-header { 
  padding:14px 16px; 
  display:flex; 
  align-items:center; 
  justify-content:space-between; 
  background: rgba(0,0,0,0.4); 
  border-bottom:1px solid rgba(255,255,255,0.1); 
}
.brand{ font-weight:800; font-size:16px; letter-spacing:0.5px; }
.desc{ font-size:12px; color:rgba(255,255,255,0.75); }

.chat-area { 
  padding:16px; 
  display:flex; 
  flex-direction:column; 
  gap:12px; 
  min-height:220px; 
  max-height:50vh; 
  overflow-y:auto; 
  overflow-x:hidden; 
  box-sizing: border-box;
}
.bubble { 
  max-width: 90%; 
  padding:12px 14px; 
  border-radius:18px; 
  line-height:1.4; 
  font-size:14px; 
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  word-wrap: break-word; 
  overflow-wrap: break-word; 
  box-sizing: border-box;
}
.bubble.user { 
  align-self:flex-end; 
  background: linear-gradient(135deg, #a8ff78, #78ffd6);
  color:#000; 
  border-bottom-right-radius:6px; 
}
.bubble.bot { 
  align-self:flex-start; 
  background: linear-gradient(135deg, #84fab0, #8fd3f4);
  color:#000; 
  border-bottom-left-radius:6px; 
}
.typing{ font-size:13px; color:rgba(255,255,255,0.75); padding-left:6px; }

.quick-actions{ 
  display:flex; 
  gap:8px; 
  flex-wrap:wrap; 
  margin-bottom:6px; 
}
.quick-btn{ 
  background: rgba(255,255,255,0.15); 
  border:none; 
  border-radius:10px; 
  padding:8px 12px; 
  font-size:13px; 
  cursor:pointer; 
  color:#fff; 
  backdrop-filter: blur(6px);
  transition: background .2s;
}
.quick-btn:hover{ background: rgba(255,255,255,0.25); }

.chat-input-row{ 
  display:flex; 
  gap:8px; 
  padding:12px; 
  border-top:1px solid rgba(255,255,255,0.1); 
  background: rgba(0,0,0,0.3); 
}
#chatInput{ 
  flex:1; 
  min-height:42px; 
  padding:10px 12px; 
  border-radius:12px; 
  border:1px solid rgba(255,255,255,0.2); 
  background: rgba(255,255,255,0.05); 
  color:#fff; 
  outline:none; 
  resize:none; 
}
#chatInput::placeholder{ color:rgba(255,255,255,0.5); }
#sendChatBtn{ 
  padding:10px 14px; 
  border-radius:12px; 
  border:none; 
  background: linear-gradient(135deg, #ffcc70, #ff7eb3);
  color:#111; 
  font-weight:700; 
  cursor:pointer; 
  min-width:70px; 
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

@media (max-width:600px){ 
  .chat-panel{ 
    right:0; 
    bottom:0; 
    width:100%; 
    max-width:100%; 
    border-radius:16px 16px 0 0; 
  }
}
</style>
</head>
<body>

<div class="chat-widget">
  <button class="chat-btn" id="chatToggle" aria-expanded="false" aria-controls="travelChatPanel">💬 旅遊助理</button>

  <div class="chat-panel" id="travelChatPanel" role="dialog" aria-label="Travel Assistant" aria-modal="false">
    <div class="chat-header">
      <div>
        <div class="brand">AI 旅遊助理 ✈️</div>
        <div class="desc">可詢問景點、叫 Uber、行程建議</div>
      </div>
      <div>
        <button id="closeChatPanel" style="background:none;border:none;color:#fff;cursor:pointer;font-weight:700">✕</button>
      </div>
    </div>
    <div class="chat-area" id="chatArea"></div>
    <div style="padding:0 12px 10px;">
      <div class="quick-actions" id="quickActions">
        <button class="quick-btn" data-msg="建議景點">建議景點</button>
        <button class="quick-btn" data-msg="叫 Uber">叫 Uber</button>
        <button class="quick-btn" data-msg="規劃行程">規劃行程</button>
      </div>
      <div class="chat-input-row">
        <textarea id="chatInput" placeholder="輸入您的旅遊問題..." aria-label="Message input"></textarea>
        <button id="sendChatBtn">傳送</button>
      </div>
    </div>
  </div>
</div>

<script>
const chatToggle = document.getElementById('chatToggle');
const chatPanel = document.getElementById('travelChatPanel');
const closeChatPanel = document.getElementById('closeChatPanel');
const chatArea = document.getElementById('chatArea');
const chatInput = document.getElementById('chatInput');
const sendChatBtn = document.getElementById('sendChatBtn');
const quickActions = document.getElementById('quickActions');

function openChat() {
  chatPanel.classList.add('open');
  chatToggle.setAttribute('aria-expanded','true');
  chatInput.focus();
}
function closeChat() {
  chatPanel.classList.remove('open');
  chatToggle.setAttribute('aria-expanded','false');
}
chatToggle.addEventListener('click', ()=> {
  if (chatPanel.classList.contains('open')) closeChat(); else openChat();
});
closeChatPanel.addEventListener('click', closeChat);

function appendBubble(text, who='bot') {
  const div = document.createElement('div');
  div.className = 'bubble ' + (who==='user'?'user':'bot');

  // Map integration for location strings
  const mapKeywords = ['台北101','士林夜市','象山','西門町','北投溫泉'];
  const matched = mapKeywords.find(k=>text.includes(k));
  if(who==='bot' && matched){
    const mapUrl = `https://www.google.com/maps?q=${encodeURIComponent(matched)}&output=embed`;
    div.innerHTML = `
      <div>${text}</div>
      <iframe width="100%" height="200" style="border:0; border-radius:12px; margin-top:6px;" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade" src="${mapUrl}"></iframe>
    `;
  } else {
    div.textContent = text;
  }

  chatArea.appendChild(div);
  div.scrollIntoView({behavior:'smooth'});
}

quickActions.addEventListener('click', e => {
  const btn = e.target.closest('.quick-btn'); if(!btn) return;
  sendUserMessage(btn.dataset.msg);
});
sendChatBtn.addEventListener('click', ()=> {
  const txt=chatInput.value.trim(); if(!txt) return;
  sendUserMessage(txt);
});
chatInput.addEventListener('keydown', e=>{ if(e.key==='Enter' && !e.shiftKey){e.preventDefault(); sendChatBtn.click();} });

async function sendUserMessage(text) {
  appendBubble('您：' + text, 'user');
  chatInput.value='';
  appendBubble('旅遊助理正在輸入...', 'bot');
  const reply = await mockTravelBot(text);
  chatArea.lastChild.remove();
  appendBubble('旅遊助理：' + reply, 'bot');
}

async function mockTravelBot(msg){
  await new Promise(r=>setTimeout(r,500));
  const t=msg.toLowerCase();
  if(t.includes('建議')) return "您可以參觀台北101 🏙️ 或士林夜市 🌮。";
  if(t.includes('uber')) return "已幫您叫 Uber 🚕，距離最近的車輛約 3 分鐘到達。";
  if(t.includes('行程')) return "我可以幫您規劃 2 天行程，您打算什麼時候出發？";
  return "我可以建議景點、叫 Uber 及規劃行程。試試輸入『建議景點』吧。";
}

// initial greeting
appendBubble("旅遊助理：您好！我可以協助您查詢景點、叫 Uber 或規劃行程。試試輸入『建議景點』吧。");
</script>

</body>
</html>
